name:               Build Package Deploy AWS Lambda

on:
  push:
    branches:
      - master

jobs:

  build:
    name:           Build and Package
    runs-on:        ubuntu-latest

    steps:

    - name:         Checkout
      uses:         actions/checkout@v2.3.3
      with:
        path:       hello-lambda

    - name:         Setup Go environment
      uses:         actions/setup-go@v2.1.3
      with:
        go-version: 1.15.2

    - name:         Get dependencies
      run:          go get github.com/aws/aws-lambda-go/lambda

    - name:         Build lambda
      run:          |
        cd hello-lambda/src
        export GOOS=linux
        go build -v main.go

    - name:         Package lambda
      run:          |
        cd hello-lambda/src
        zip function.zip main

    - name:         Publish artifact
      uses:         actions/upload-artifact@v2
      with:
        name:       function.zip
        path:       hello-lambda/src/function.zip
